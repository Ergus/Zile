#	$Id: Makefile.in,v 1.6 2003/05/06 22:28:41 rrt Exp $

srcdir = @srcdir@
VPATH = $(srcdir)

DESTDIR =
prefix = @prefix@
exec_prefix = @exec_prefix@

bindir = @bindir@
etcdir = $(prefix)/share/zile
mandir = @mandir@/man1

INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@
INSTALL = @INSTALL@

CC = @CC@
PROG = zile
CFLAGS = @CFLAGS@
LDFLAGS = @LDFLAGS@
ZILELIBS = ../lib/libzile.a
LIBS = $(ZILELIBS) @LIBS@
GPERF = gperf -LANSI-C

TERMINALS = ncurses
TERMINALSLIBS = term_ncurses/libterm_ncurses.a

SRCS =	$(srcdir)/basic.c	\
	$(srcdir)/bind.c	\
	$(srcdir)/buffer.c	\
	$(srcdir)/file.c	\
	$(srcdir)/fontlock.c	\
	$(srcdir)/fontlock_c.c	\
	$(srcdir)/fontlock_cpp.c\
	$(srcdir)/fontlock_csharp.c\
	$(srcdir)/fontlock_java.c\
	$(srcdir)/funcs.c	\
	$(srcdir)/glue.c	\
	$(srcdir)/help.c	\
	$(srcdir)/keys.c	\
	$(srcdir)/killring.c	\
	$(srcdir)/line.c	\
	$(srcdir)/macro.c	\
	$(srcdir)/main.c	\
	$(srcdir)/minibuf.c	\
	$(srcdir)/pathbuffer.c  \
	$(srcdir)/rc.c		\
	$(srcdir)/redisplay.c	\
	$(srcdir)/registers.c	\
	$(srcdir)/search.c	\
	$(srcdir)/undo.c	\
	$(srcdir)/variables.c	\
	$(srcdir)/window.c

OBJS =	basic.o			\
	bind.o			\
	buffer.o		\
	file.o			\
	fontlock.o		\
	fontlock_c.o		\
	fontlock_cpp.o		\
	fontlock_csharp.o	\
	fontlock_java.o		\
	funcs.o			\
	glue.o			\
	help.o			\
	keys.o			\
	killring.o		\
	line.o			\
	macro.o			\
	main.o			\
	minibuf.o		\
	pathbuffer.o            \
	rc.o			\
	redisplay.o		\
	registers.o		\
	search.o		\
	undo.o			\
	variables.o		\
	window.o

.c.o:
	$(CC) -c -I. -I.. -I$(srcdir) -I$(srcdir)/../lib $(CFLAGS) $<

all: paths.h maketerminals $(PROG) zile.1

maketerminals:
	@for f in $(TERMINALS); do \
		(cd term_$$f && $(MAKE) all); \
	done

$(PROG): $(OBJS) $(TERMINALSLIBS) $(ZILELIBS)
	$(CC) $(LDFLAGS) -o $(PROG) $(OBJS) $(TERMINALSLIBS) $(LIBS)

paths.h:
	@echo "Producing \`paths.h'."
	@echo "/* Automatically generated file.  NO NOT EDIT! */" >paths.h.tmp
	@echo "" >>paths.h.tmp
	@echo '#define PATH_PREFIX "${prefix}"' >>paths.h.tmp
	@echo '#define PATH_DATA "${etcdir}"' >>paths.h.tmp
	@sh ${srcdir}/../move-if-change paths.h.tmp paths.h

fontlock_c.c: fontlock_c.gperf
	echo "#include \"config.h\"" >fontlock_c.c
	echo "#if ENABLE_C_MODE" >>fontlock_c.c
	$(GPERF) -ac -N is_c_keyword fontlock_c.gperf >>fontlock_c.c
	echo "#endif" >>fontlock_c.c

fontlock_cpp.c: fontlock_cpp.gperf
	echo "#include \"config.h\"" >fontlock_cpp.c
	echo "#if ENABLE_CPP_MODE" >>fontlock_cpp.c
	$(GPERF) -ac -k 1,2,3 -N is_cpp_keyword fontlock_cpp.gperf >>fontlock_cpp.c
	echo "#endif" >>fontlock_cpp.c

fontlock_csharp.c: fontlock_csharp.gperf
	echo "#include \"config.h\"" >fontlock_csharp.c
	echo "#if ENABLE_CSHARP_MODE" >>fontlock_csharp.c
	$(GPERF) -ac -k 1,2,4 -N is_csharp_keyword fontlock_csharp.gperf >>fontlock_csharp.c
	echo "#endif" >>fontlock_csharp.c

fontlock_java.c: fontlock_java.gperf
	echo "#include \"config.h\"" >fontlock_java.c
	echo "#if ENABLE_JAVA_MODE" >>fontlock_java.c
	$(GPERF) -ac -k 1,2 -N is_java_keyword fontlock_java.gperf >>fontlock_java.c
	echo "#endif" >>fontlock_java.c

zile.1: zile.1.in Makefile
	echo '.\" Automatically generated file: NO DOT EDIT!' >zile.1
	sed "s+@ETCDIR@+$(etcdir)+" <$(srcdir)/zile.1.in >>zile.1

.PHONY: install uninstall clean realclean distclean mostlyclean

install: all
	$(srcdir)/../mkinsdir.sh $(DESTDIR)$(bindir) $(DESTDIR)$(mandir)
	$(INSTALL_PROGRAM) $(PROG) $(DESTDIR)$(bindir)
	$(INSTALL_DATA) $(srcdir)/$(PROG).1 $(DESTDIR)$(mandir)/$(PROG).1

uninstall:
	rm -f $(DESTDIR)$(bindir)/$(PROG)
	rm -f $(DESTDIR)$(mandir)/$(PROG).1

clean:
	@for f in $(TERMINALS); do \
		(cd term_$$f && $(MAKE) $@); \
	done
	-rm -f $(PROG) paths.h zile.1 *.o

distclean: clean
	@for f in $(TERMINALS); do \
		(cd term_$$f && $(MAKE) $@); \
	done
	-rm -f Makefile

realclean: distclean
	@for f in $(TERMINALS); do \
		(cd term_$$f && $(MAKE) $@); \
	done
	-rm -f extern.h

mostlyclean: clean

$(OBJS): $(srcdir)/zile.h $(srcdir)/extern.h ../config.h
help.o main.o: $(srcdir)/version.h paths.h
variables.o: $(srcdir)/../lib/htable.h
bind.o: $(srcdir)/tbl_funcs.h
variables.o: $(srcdir)/tbl_vars.h
